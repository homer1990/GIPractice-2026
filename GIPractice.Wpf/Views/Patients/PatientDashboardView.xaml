<UserControl x:Class="GIPractice.Wpf.Views.Patients.PatientDashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:loc="clr-namespace:GIPractice.Wpf.Localization"
             xmlns:patients="clr-namespace:GIPractice.Wpf.Views.Patients">

    <DockPanel Margin="8"
               Background="{DynamicResource Brush.PanelBackground}">

        <!-- Status bar -->
        <TextBlock DockPanel.Dock="Bottom"
                   Margin="0,4,0,0"
                   Foreground="Gray"
                   Text="{Binding StatusMessage}" />

        <!-- Header: patient card + summary -->
        <Border DockPanel.Dock="Top"
                Padding="8"
                Margin="0,0,0,8"
                BorderBrush="{DynamicResource Brush.Border}"
                BorderThickness="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <!-- Patient card -->
                    <ColumnDefinition Width="2*" />
                    <!-- Summary counters -->
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Reusable card -->
                <patients:PatientCardView Grid.Column="0"
                                          DataContext="{Binding Patient}" />

                <!-- Summary counters -->
                <StackPanel Grid.Column="1"
                            Orientation="Vertical"
                            Margin="8,0,0,0">
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=TotalVisits}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.TotalVisits}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=TotalEndoscopies}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.TotalEndoscopies}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=TotalTests}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.TotalTests}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=TotalInfaiTests}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.TotalInfaiTests}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=TotalOperations}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.TotalOperations}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="{loc:Loc Table=Dashboard Field=ActiveTreatments}" />
                        <Run Text=": " />
                        <Run Text="{Binding Summary.ActiveTreatmentsCount}" />
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Timeline grid (unchanged) -->
        <DataGrid ItemsSource="{Binding Timeline}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="{loc:Loc Table=Dashboard Field=ColumnWhen}"
                                    Width="160"
                                    Binding="{Binding WhenUtc, StringFormat='yyyy-MM-dd HH:mm'}" />
                <DataGridTextColumn Header="{loc:Loc Table=Dashboard Field=ColumnKind}"
                                    Width="120"
                                    Binding="{Binding Kind}" />
                <DataGridTextColumn Header="{loc:Loc Table=Dashboard Field=ColumnTitle}"
                                    Width="*"
                                    Binding="{Binding Title}" />
                <DataGridTextColumn Header="{loc:Loc Table=Dashboard Field=ColumnDescription}"
                                    Width="2*"
                                    Binding="{Binding Description}" />
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
