<UserControl x:Class="GIPractice.Wpf.Views.Patients.PatientSearchView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:loc="clr-namespace:GIPractice.Wpf.Localization">

    <DockPanel Background="{DynamicResource Brush.PanelBackground}">

        <!-- Status + Paging -->
        <DockPanel DockPanel.Dock="Bottom"
                   Margin="0,4,0,0">

            <!-- Left: status -->
            <TextBlock Foreground="Gray"
                       VerticalAlignment="Center"
                       Text="{Binding StatusMessage}" />

            <!-- Right: pagination -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button Content="◀"
                        Margin="8,0,4,0"
                        Padding="8,2"
                        Command="{Binding PreviousPageCommand}"
                        IsEnabled="{Binding HasPreviousPage}" />

                <TextBlock VerticalAlignment="Center"
                           Margin="4,0"
                           Text="{Binding PageInfo}" />

                <Button Content="▶"
                        Margin="4,0,0,0"
                        Padding="8,2"
                        Command="{Binding NextPageCommand}"
                        IsEnabled="{Binding HasNextPage}" />
            </StackPanel>
        </DockPanel>


        <!-- Search filters -->
        <StackPanel DockPanel.Dock="Top"
                    Margin="0,0,0,8">
            <UniformGrid Columns="4"
                         Rows="2"
                         Margin="0,0,0,4">

                <!-- Row 1 -->
                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=LastName}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="150"
                             Text="{Binding LastName, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=FirstName}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="150"
                             Text="{Binding FirstName, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=Father}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="150"
                             Text="{Binding FathersName, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=PersonalNumber}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="150"
                             Text="{Binding PersonalNumber, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <!-- Row 2 -->
                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=BirthFrom}"
                               Style="{StaticResource FormLabel}" />
                    <DatePicker Width="140"
                                SelectedDate="{Binding BirthDateFrom}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=BirthTo}"
                               Style="{StaticResource FormLabel}" />
                    <DatePicker Width="140"
                                SelectedDate="{Binding BirthDateTo}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=Phone}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="140"
                             Text="{Binding PhoneNumber, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,8,0">
                    <TextBlock Text="{loc:Loc Table=Patients Field=Email}"
                               Style="{StaticResource FormLabel}" />
                    <TextBox Width="160"
                             Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
            </UniformGrid>

            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button Content="{loc:Loc Table=Patients Field=Search}"
                        Padding="12,4"
                        Command="{Binding SearchCommand}" />
            </StackPanel>
        </StackPanel>
        <!-- Patients grid -->
        <DataGrid x:Name="PatientsGrid"
              ItemsSource="{Binding Patients}"
              SelectedItem="{Binding SelectedPatient}"
              AutoGenerateColumns="False"
              IsReadOnly="True"
              CanUserSortColumns="True"
              Sorting="PatientsGrid_Sorting">

            <DataGrid.InputBindings>
                <MouseBinding MouseAction="LeftDoubleClick"
                              Command="{Binding OpenDetailsCommand}" />
            </DataGrid.InputBindings>

            <DataGrid.Columns>
                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnId}"
                                    Binding="{Binding Id}"
                                    SortMemberPath="Id"
                                    Width="60" />

                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnLastName}"
                                    Binding="{Binding LastName}"
                                    SortMemberPath="LastName"
                                    Width="*" />

                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnFirstName}"
                                    Binding="{Binding FirstName}"
                                    SortMemberPath="FirstName"
                                    Width="*" />

                <!-- Father: not server-sorted for now -->
                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnFather}"
                                    Binding="{Binding FathersName}"
                                    CanUserSort="False"
                                    Width="*" />

                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnPersonalNumber}"
                                    Binding="{Binding PersonalNumber}"
                                    SortMemberPath="PersonalNumber"
                                    Width="140" />

                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnBirthDate}"
                                    Binding="{Binding BirthDay, StringFormat='yyyy-MM-dd'}"
                                    SortMemberPath="BirthDay"
                                    Width="120" />

                <!-- Phone & Email: leave unsortable for now -->
                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnPhone}"
                                    Binding="{Binding PhoneNumber}"
                                    CanUserSort="False"
                                    Width="140" />
                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnEmail}"
                                    Binding="{Binding Email}"
                                    CanUserSort="False"
                                    Width="180" />

                <DataGridTextColumn Header="{loc:Loc Table=Patients Field=ColumnLastVisit}"
                                    Width="160"
                                    Binding="{Binding LastVisitUtc, StringFormat='yyyy-MM-dd HH:mm'}"
                                    SortMemberPath="LastVisit" />
            </DataGrid.Columns>

        </DataGrid>
    </DockPanel>
</UserControl>
